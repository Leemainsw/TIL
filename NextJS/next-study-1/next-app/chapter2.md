# Chapter 02 넥스트의 기본 기능

## 목차
1. 넥스트에서 라우팅하기
2. 정적 파일 사용하기
3. 서버로부터 데이터 불러오기
4. styled-jsx로 스타일링 하기
5. 공통 페이지 만들기
6. 공통 문서 만들기
7. 에러 페이지 만들기

### 넥스트에서 라우팅하기

넥스트에서 주소 이동을 할 때에는 주로 Link 컴포넌트를 사용하게 된다.
Link 컴포넌트는 Dom을 가지지는 않지만 자식인 ```<a>``` 태그를 클릭하게 되면 클라이언트 측 내비게이션을 실행하여 페이지 전체를 불러오지 않고 주소를 이동할 수 있다.
Link 컴포넌트를 사용하여 주소 이동을 하게 되면 브라우저의 History API를 지원함으로써 이전에 렌더링 된 페이지를 가져오게 된다. 

1. 만약 Link 컴포넌트를 사용하지 않고 a 태그만을 이용하여 주소 이동을 하게 된다면 **페이지 전체를 새로 받아오게 되어 속도가 느려지고 깜빡임도 발생한다. 뒤로가기를 하게 되어도 마찬가지이다.**  
2. 만약 Link 컴포넌트 안에 a 태그를 사용하지 않는다면 **라우팅 기능을 수행하지만 웹 접근성과 SEO에 좋지 않다.**  
3. 만약 Link 컴포넌트 안에 리액트 컴포넌트를 사용한다면 **라우팅 기능이 작동하지 않는다.**  

#### Link 컴포넌트의 속성
href: string 값으로 이동할 경로 또는 URL  
as: string 값으로 브라우저의 URL에 표시될 값으로 Next 버전 9.5.3 이전에 동적 라우팅을 위하여 사용된다.  
replace: boolean 값으로 브라우저의 history 스택에 url을 추가하지 않고 현재 상태를 변경한다.  
scroll: boolean 값으로 스크롤을 맨 위로 이동할지 설정하는 값이다.  
shallow: boolean 값으로 서버에서 데이터를 불러오는 작업을 스킵할 때 사용한다.  
passHref: boolean 값으로 자식에게 href를 전달하게 된다. 리액트 컴포넌트에 href를 전달할 수 있게 된다.  
prefetch: boolean 값으로 백그라운드에서 페이지를 미리 가져오게 된다. 브라우저 화면의 Link 컴포넌트의 페이지들을 미리 가져오게 된다.  

#### 동적 페이지 라우팅하기
- 파일 이름을 대괄호로 감싸서 만들게 된다면, 이는 페이지가 정적 페이지가 아닌 동적 페이지임을 의미하게 된다.
```[name].jsx```등
- 파일 이름에서 대괄호 안에 있는 값은 라우터 객체의 query 속성으로 들어가게 된다.

#### 라우터 객체를 이용하여 라우팅 하기
- 라우터 객체 안에는 push, replace, back 등의 함수를 이용하여 주소를 이동할 수 있다.
주로 push 함수를 자주 이용하게 되는데, 펏 번째 인자에 pathname을 두 번째 인자에는 asPath를 세 번째로는 options를 전달 할 수 있다. 

### 넥스트에서 정적 파일 사용하기
- public 폴더 내에 원하는 정적 파일을 업로드 한 뒤, 클라이언트에서는 public을 제외한 경로로 사용할 수 있다.

### 서버로부터 데이터 불러오기
넥스트에는 두 가지 형태의 사전 렌더링이 존재한다.
1. 정적 생성 : 빌드 시에 페이지를 HTML로 만들어 요청 시 제공한다.
2. 서버사이드렌더링 : 페이지 요청 시 서버 사이드 렌더링을 통하여 HTML을 제공한다.  
만약 외부 데이터를 필요로 하지 않는다면 넥스트는 빌드 시에 페이지를 렌더링하여 요청 시마다 제공하게 된다. 하지만 외부 데이터가 필요하다면 서버 사이드 렌더링을 통하여 외부 데이터를 이용한 렌더링을 한 뒤에 HTML을 제공한다. 

#### getServerSideProps

넥스트는 getServerSideProps라는 페이지의 데이터를 서버로부터 제공받는 기본 API를 가지고 있다.  
이름 그대로 서버 측에서 props를 받아오는 기능을 한다. 페이지를 요청할 때마다 실행되며 getServerSideProps에서 페이지로 전달해준 데이터를 서버에서 렌더링하게 된다. 서버에서 실행되기 때문에 브라우저 콘솔이 아닌 터미널 콘솔에서 출력되는 것을 확인할 수 있다.

#### getStaticProps
getStaticProps는 getServerSideProps와 다르게 빌드 시에 데이터를 불러와 결과를 json으로 저장하여 사용하게 되기 때문에 일관된 데이터를 보여주게 된다. ```revalidate``` 값을 전달해주면 해당 초마다 요청이 들어올 때 데이터를 갱신되게 해준다.

getServerSideProps와는 다르게 query대신 params를 사용한다. 그리고 getStaticPaths를 이용하여 params를 미리 지정해주어야 한다. fallback 값은 지정한 경로 이외의 경로에 대해 설정을 하게 된다. 미리 렌더링 된다고 생각하면 쉬움 (데이터를 가지고 있다가 보여준다는 느낌)

#### getInitialProps
getInitialProps에서 데이터를 console로 찍게 되면 처음 브라우저로 이동할 때에는 브라우저 콘솔에서 데이터가 출력되고 새로고침을 하게 되면 터미널에서 데이터가 출력된다. 이는 getInitialProps를 사용하게 되면 초기 렌더링 시에 서버에서 데이터를 불러오지만, 클라이언트 측 내비게이션을 사용하게 되면 클라이언트 측에서 데이터를 불러오는 것을 의미한다.

### styled-jsx로 스타일링하기
styled jsx는 CSS in js 라이브러리로 css를 캡슐화하고 범위가 지정되게 만들어 구성 요소를 스타일링 할 수 있다. 넥스트에서 기본으로 제공하기에 별도의 모듈 설치가 필요하지 않다.


### 공통 페이지 만들기 

1. 공통 페이지(_app) 만들기  
- app 컴포넌트는 모든 페이지의 공통 페이지 역할을 한다.
- 페이지들의 공통된 레이아웃
- 페이지를 탐색할 때 상태 유지
- 추가 데이터를 페이지에 주입
- 글로벌 css 추가
등의 역할을 할 수 있다. 

코드를 보면 Component라는 props를 받게 되는데, Component는 불러오는 페이지이다. 또한, Componet는 pageProps를 props로 받고 있는데 이는 pages 안의 파일에서 getServerSideProps, getStaticProps 혹은 getInitialProps로 페이지에 전달해주는 props이다.

2. 공통 문서 (_document) 만들기
- 사용자 정의 Document는 일반적으로 응용 프로그램 html 및 body 태그를 보강하는데 사용된다.
- 이를 이용하여 title, description, meta등 프로젝트의 정보를 제공하는 HTMl 코드를 작성할 수 있다
- 폰트나 외부 api, dn 등을 불러올 수 있다.
- css in js의 서버 사이드 렌더링을 위한 설정을 할 수 있다.