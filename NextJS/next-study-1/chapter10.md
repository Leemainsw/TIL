# Chapter 10 회원가입과 로그인

## 목차
1. 회원가입 인풋
2. 회원가입 셀렉터
3. 회원가입 버튼
4. 회원가입 api
5. 유저 정보 저장하기
6. 회원가입 밸리데이션
7. useValidatieMode 훅스 만들기
8. 회원가입 비밀번호 밸리데이션
9. 회원가입 셀렉터 밸리데이션
10. 유저 로그인 뷰 만들기
11. 로그인 모달 만들기
12. 로그인 api 만들기
13. 로그인 밸리데이션
14. 로그인 유지하기
15. 유저 메뉴 만들기
16. 로그아웃 하기
17. 컴포넌트 최적화
18. 헤더 컴포넌트 최적화

### 회원가입 인풋

**디자인 시스템**  
> 디자인 시스템이란 서비스를 만드는 데 사용할 색깔, 서체, 컴포넌트 및 규칙을 정리해놓은 것으로 서비스에 일관된 디자인을 줄 수 있고, 브랜딩을 할 수 있다. 또한, 만들어둔 컴포넌트를 재사용하게 됨으로써 개발 속도와 효율성도 높아지게 된다. 

디자인을 보면 인풋이나 버튼 등의 컴포넌트는 서비스 여러 곳에서 사용되는데, 서비스에서 컴포넌트들은 일관된 스타일을 가지고 있다. 이는 서비스마다 컴포넌트에 디자인 시스템을 만들어 사용하기 때문이다.


### 회원가입 api
회원가입 Api는 다음의 순서를 거쳐 유저를 만들게 된다.
```md
1. api method가 post인지 확인한다
2. req.body에 필요한 값이 전부 들어 있는지 확인한다
3. email이 중복인지 확인한다.
4. password를 암호화한다.
5. 유저 정볼르 추가한다.
6. 추가된 유저의 정보와 token을 전달한다.
```

**비밀번호 암호화하기**  
비밀번호를 안전하게 저장하기 위해서 암호화를 하려고 한다.  
```bcryptjs```라이브러리를 사용한다.   


**jwt 토큰 생성하기**  
> JWT (Json Web Token)은 전자 서명된 URL로 이동할 수 있는 문자만 구성된 jSON이다.

jwt를 사용하여 서버와 클라이언트간 통신할 수 있는 사용자 인증 토큰을 만들어보자.  
```jsonwebtoken```라이브러리를 사용한다.   

코드 설명
```javascript
      res.setHeader(
        "Set-Cookie",
        `access_token=${token}; path=/; expires=${new Date(
          Date.now() + 60 * 60 * 24 * 1000 * 3 //3일
        )}; httponly`
      );
```
access_toekn이라는 쿠키명에 토큰을 저장하며 path는 "/", expires로 지금 시간에 3일을 더해 만료일을 정하고, httponly를 사용하여 api 통신에서만 쿠키 값을 불러올 수 있고 http 이외의 접근은 불가능하도록 한 코드이다.  

### 유저 정보 저장하기
**delete를 사용하여 객체의 속성 제거하기**  
delete를 사용하여 객체의 속성을 제거하게 되면 ```해당 객체의 제거될 속성은 optional이어야 한다```는 타입에러가 발생한다.
```javascript
Partial<Pick<StoredUserType, "password">>
```
다음 코드는 TS의 유틸리티 중 하나로, StoredUserType의 password 속성을 partial로 만든 타입을 만들게 된다. 이를 이용하여 타입에러 없이 delete를 사용할 수 있다.

### 로그인 api
로그인 Api는 다음의 순서를 거쳐 유저를 만들게 된다.
```md
1. api method가 POST인지 확인
2. re.body에 필요한 값이 전부 들었는지 확인
3. password 확인
4. 추가된 유저의 정보와 token을 전달
```

### 로그인 유지하기

쿠키에 access_token이 있다는 것은 유저가 로그인되어 있음을 의미한다.
모든 페이지에서 유저가 페이지에 접속하였을 때 access_token이 있다면 유저의 정보를 불러와 리덕스 스토어에 저장하여 로그인된 상태로 만들어야 한다. 그러기 위해서 App 컴포넌트에서 쿠키의 access_token을 서버로 보내 유저의 정보를 받아오도록 해야 한다.

플로우  
1. _app.tsx 파일에서 cookie에 access_token이 있는지 확인한다.
2. 있다면 access_token의 유저 정보를 받아오는 API를 호출한다.
3. Redux에 유저 정보를 업데이트 한 뒤, isLogged를 true로 바꾸어준다.

### 로그아웃하기
1. 쿠키의 access_token 제거
2. 리덕스 스토어의 유저 정보 제거
3. isLogged를 false로 변경

